/*! qajax 1.3.0 - Simple Promise ajax library based on Q */
!function(a,b){"object"==typeof exports?module.exports=b:"function"==typeof define&&define.amd?define(["q"],function(c){return b(c,a.XMLHttpRequest,a.FormData)}):a.Qajax=b(a.Q,a.XMLHttpRequest,a.FormData)}(this,function(a,b,c){"use strict";function d(){}function e(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&void 0!==a[b]&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function f(a){return-1===a.indexOf("?")}function g(a){var b={};if(a)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function h(b,d){if(0===arguments.length)throw new Error("Qajax: settings are required");var h;if("string"==typeof b)h="object"==typeof d&&d||{},h.url=b;else{if("object"!=typeof b)throw new Error("Qajax: settings must be an object");h=b}if(!h.url)throw new Error("Qajax: settings.url is required");if("cancellation"in h&&!a.isPromiseAlike(h.cancellation))throw new Error("cancellation must be a Promise.");this.headers=g(this.headers),this.params={};for(var i in h)this[i]=h[i];var k=this.params,l=this.cache;l&&(k[l===!0?"_":l]=(new Date).getTime());var m=this.base+this.url,n=e(k);n&&(m=m+(f(m)?"?":"&")+n),this.url=m;var o=this.data,p=this.headers;null===o||"object"!=typeof o||c&&o instanceof c||(j in p||(p[j]="application/json"),this.data=JSON.stringify(o));var q=this._send,r=this;this.send=function(){return a.fcall(function(){return q.call(r)})}}function i(a,b){return new h(a,b).send()}var j="Content-Type",k=a.defer().promise;return h.prototype={log:d,timeout:6e4,cache:"undefined"==typeof window?!1:!!(window.ActiveXObject||"ActiveXObject"in window),method:"GET",base:"",withCredentials:!1,cancellation:k,_send:function(){var c=new b,d=a.defer(),e=this.log,f=this.method,g=this.url;c.onreadystatechange=function(){if(4===c.readyState)try{e(f+" "+g+" => "+c.status),c.status?d.resolve(c):d.reject(c)}catch(a){d.reject(c)}},c.onprogress=function(a){d.notify(a)},c.open(f,g,!0),this.responseType&&(c.responseType=this.responseType);var h=this.headers;for(var i in h)h.hasOwnProperty(i)&&c.setRequestHeader(i,h[i]);this.withCredentials&&(c.withCredentials=!0);var j=this.data;return void 0!==j&&null!==j?c.send(j):c.send(),this.cancellation.fin(function(){d.promise.isFulfilled()||(e("Qajax cancellation reached."),c.abort())}),this.timeout?d.promise.timeout(this.timeout).fail(function(a){throw a instanceof Error&&(e("Qajax request delay reach in "+f+" "+g),c.abort()),c}):d.promise}},i.defaults=h.prototype,i.Builder=h,i.filterStatus=function(b){var c,d,e=this.log;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(f){e("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},i.filterSuccess=i.filterStatus(function(a){return a>=200&&300>a||304===a}),i.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},i.getJSON=function(a){return i({url:a,method:"GET"}).then(i.filterSuccess).then(i.toJSON)},i.serialize=e,i});