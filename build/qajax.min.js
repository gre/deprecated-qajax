/*! qajax 1.2.0 - Simple Promise ajax library based on Q */
!function(a,b){"object"==typeof exports?module.exports=b:"function"==typeof define&&define.amd?define(["q"],function(c){return b(c,a.XMLHttpRequest)}):a.Qajax=b(a.Q,a.XMLHttpRequest)}(this,function(a,b){"use strict";function c(){}function d(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&void 0!==a[b]&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function e(a){return-1===a.indexOf("?")}function f(a){var b={};if(a)for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function g(b,c){if(0===arguments.length)throw new Error("Qajax: settings are required");var g;if("string"==typeof b)g="object"==typeof c&&c||{},g.url=b;else{if("object"!=typeof b)throw new Error("Qajax: settings must be an object");g=b}if(!g.url)throw new Error("Qajax: settings.url is required");if("cancellation"in g&&!a.isPromiseAlike(g.cancellation))throw new Error("cancellation must be a Promise.");this.headers=f(this.headers),this.params={};for(var h in g)this[h]=g[h];var j=this.params,k=this.cache;k&&(j[k===!0?"_":k]=(new Date).getTime());var l=this.base+this.url,m=d(j);m&&(l=l+(e(l)?"?":"&")+m),this.url=l;var n=this.data,o=this.headers;null!==n&&"object"==typeof n&&(i in o||(o[i]="application/json"),this.data=JSON.stringify(n));var p=this._send,q=this;this.send=function(){return a.fcall(function(){return p.call(q)})}}function h(a,b){return new g(a,b).send()}var i="Content-Type",j=a.defer().promise;return g.prototype={log:c,timeout:6e4,cache:"undefined"==typeof window?!1:!!(window.ActiveXObject||"ActiveXObject"in window),method:"GET",base:"",withCredentials:!1,cancellation:j,_send:function(){var c=new b,d=a.defer(),e=this.log,f=this.method,g=this.url;c.onreadystatechange=function(){if(4===c.readyState)try{e(f+" "+g+" => "+c.status),c.status?d.resolve(c):d.reject(c)}catch(a){d.reject(c)}},c.onprogress=function(a){d.notify(a)},c.open(f,g,!0),this.responseType&&(c.responseType=this.responseType);var h=this.headers;for(var i in h)h.hasOwnProperty(i)&&c.setRequestHeader(i,h[i]);this.withCredentials&&(c.withCredentials=!0);var j=this.data;return void 0!==j&&null!==j?c.send(j):c.send(),this.cancellation.fin(function(){d.promise.isFulfilled()||(e("Qajax cancellation reached."),c.abort())}),this.timeout?d.promise.timeout(this.timeout).fail(function(a){throw a instanceof Error&&(e("Qajax request delay reach in "+f+" "+g),c.abort()),c}):d.promise}},h.defaults=g.prototype,h.Builder=g,h.filterStatus=function(b){var c,d,e=this.log;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(f){e("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},h.filterSuccess=h.filterStatus(function(a){return a>=200&&300>a||304===a}),h.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},h.getJSON=function(a){return h({url:a,method:"GET"}).then(h.filterSuccess).then(h.toJSON)},h.serialize=d,h});